<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Discord RPC Test</title>
        <script src="../lib/CSInterface.js"></script>
        <script>
            window.AE_DISCORD_CLIENT_ID = "1469933901261701212";
        </script>
        <script src="./discordrpc.js"></script>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div class="divider">Status: <span id="status" class="status status-disconnected">Not connected</span></div>
            
        <div id="controls">
            <button id="refresh-btn">Refresh</button>
            <button id="connect-btn">Try Connect</button>
        </div>
        <div class="source-code">
            Made by: <a href="https://github.com/harpoonwithaz/ae-discord-rpc">harpoonwithaz</a>
        </div>
        <pre id="log"></pre>
        <script>
            var csInterface;
            var OPEN_CONSOLE = false;

            function rpcLog(msg) {
                var el = document.getElementById('log');
                var line = '[' + new Date().toLocaleTimeString() + '] ' + msg + '\n';
                el.textContent += line;
                el.scrollTop = el.scrollHeight;
            }
            window.rpcLog = rpcLog;
            window.onerror = function (msg, src, line, col) {
                rpcLog('ERROR: ' + msg + ' @ ' + src + ':' + line + ':' + col);
            };

            document.addEventListener('DOMContentLoaded', function () {
                csInterface = new CSInterface();

                if (window.initDiscordRpc) {
                    window.initDiscordRpc(csInterface);
                    rpcLog('initDiscordRpc called');
                }

                document.getElementById('refresh-btn').onclick = function () {
                    csInterface.evalScript('getAeContext()', function (result) {
                        rpcLog('getAeContext -> ' + result);
                    });
                };

                document.getElementById('connect-btn').onclick = function () {
                    if (window.initDiscordRpc) {
                        window.initDiscordRpc(csInterface);
                        rpcLog('connect button pressed');
                    }
                };
            });
        </script>
    </body>
</html>